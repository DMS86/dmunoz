
<!doctype html>
<html lang="None">
  <head>
    <meta charset="utf-8">
    <title>Android: How-to Authenticate with OAuth 2.0 - Client-Side in Instagram - DMunoz's Blog</title>
    <meta name="robots" content="follow, all" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="I assume that you have an Android application currently working, and that your main class is called `MainActivity`. These are the steps to follow: 1. Create an Instagram account 2. [Register you application](https://instagram.com/developer/) # 3. Register a New Client Fill the form fields as follows. Note that in the Redurect..." />
    <meta name="keywords" content="android,instagram,oauth2.0" />
    <meta name="author" content="Fantomas42" />
    
    <meta name="generator" content="Zinnia 0.15.2" />

    <link rel="pingback" href="/xmlrpc/" />
    <link rel="shortcut icon" href="/site_media/static/zinnia/theme/img/favicon.ico" />
    <link rel="home" href="/blog/" />
    <link rel="stylesheet" type="text/css" media="screen, projection" href="/site_media/static/zinnia/theme/css/screen.css" />
    <link rel="stylesheet" type="text/css" media="print" href="/site_media/static/zinnia/theme/css/print.css" />
    <!--[if lt IE 8]>
        <link rel="stylesheet" type="text/css" media="screen, projection" href="/site_media/static/zinnia/theme/css/ie.css" />
    <![endif]-->
    
  
    <link rel="index" href="/blog/" />
    <link rel="author" type="text/plain" href="/blog/humans.txt" />
    <link rel="EditURI" type="application/rsd+xml" href="/blog/rsd.xml" />
    <link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/blog/wlwmanifest.xml" />
    <link rel="search" type="application/opensearchdescription+xml" title="Zinnia's Weblog" href="/blog/opensearch.xml" />
    <link rel="alternate" type="application/rss+xml" title="RSS feed of latest entries" href="/blog/feeds/" />
    <link rel="alternate" type="application/rss+xml" title="RSS feed of latest discussions" href="/blog/feeds/discussions/" />
    
<link rel="archives" title="Archives August 2015" href="/blog/2015/08/" />



  
  
  <link rel="shortlink" href="http://example.com/blog/1/" />
  <link rel="canonical" href="/blog/2015/08/26/android-how-authenticate-oauth-20-client-side-instagram/" />
  
  <link rel="alternate" type="application/rss+xml" title="RSS feed of discussions on Android: How-to Authenticate with OAuth 2.0 - Client-Side in Instagram"
        href="/blog/feeds/discussions/2015/08/26/android-how-authenticate-oauth-20-client-side-instagram/" />
  <link rel="alternate" type="application/rss+xml" title="RSS feed of comments on Android: How-to Authenticate with OAuth 2.0 - Client-Side in Instagram"
        href="/blog/feeds/comments/2015/08/26/android-how-authenticate-oauth-20-client-side-instagram/" />
  <link rel="alternate" type="application/rss+xml" title="RSS feed of pingbacks on Android: How-to Authenticate with OAuth 2.0 - Client-Side in Instagram"
        href="/blog/feeds/pingbacks/2015/08/26/android-how-authenticate-oauth-20-client-side-instagram/" />
  <link rel="alternate" type="application/rss+xml" title="RSS feed of trackbacks on Android: How-to Authenticate with OAuth 2.0 - Client-Side in Instagram"
        href="/blog/feeds/trackbacks/2015/08/26/android-how-authenticate-oauth-20-client-side-instagram/" />
  

    
  </head>
  <body class="zinnia default blue right-sidebar entry entry-1 year-2015 month-08 week-35 day-26">
    <div class="container">
      <header id="header" role="banner">
        <nav>
          <ul class="top-navigation">
            <li>
              <a href="/blog/sitemap/" title="Sitemap" class="sitemap" rel="sitemap">
                Sitemap
              </a>
            </li>
            <li>
              <a href="/blog/feeds/" title="RSS feed of latest entries" class="feeds">
                RSS feed
              </a>
            </li>
          </ul>
        </nav>
        <form method="get" action="/blog/search/">
          <p>
            <input type="text" name="pattern" placeholder="Keywords..."  />
            <input type="submit" class="submitbutton" value="OK" />
          </p>
        </form>
        <h1>
          <a href="/blog/" title="Zinnia's Weblog" rel="home">
            DMunoz's blog
          </a>
        </h1>
        

      </header>
      
      <div id="content" class="hfeed" role="main">
        


  
<article id="entry-1" class="hentry">
  
  <header class="entry-header page-header">
    <h2 class="entry-title">
    
      <a href="/blog/2015/08/26/android-how-authenticate-oauth-20-client-side-instagram/" title="Android: How-to Authenticate with OAuth 2.0 - Client-Side in Instagram" rel="bookmark">
        Android: How-to Authenticate with OAuth 2.0 - Client-Side in&nbsp;Instagram
      </a>
    
    
      <br />
      <small class="entry-info">
        
        
        
        Written by
        
        <span class="vcard author">
          <a href="/blog/authors/dmunoz/" class="fn url nickname" rel="author"
             title="Show all dmunoz's entries">dmunoz</a></span>
        
        on
        
        
        
        
        <time class="published" datetime="2015-08-26T23:31:28+00:00" pubdate="pubdate">Aug. 26, 2015</time>
        
        
        
        .
        
        
      </small>
    
    </h2>
    
    <p class="entry-last-update" style="display: none;">
      Last update on <time class="updated" datetime="2015-08-26T23:41:37.712174+00:00">Aug. 26, 2015</time>.
    </p>
    
  </header>
  

  
  <div class="entry-body">
    
    
    
    
    <div class="entry-content lead">
      <p>I assume that you have an Android application currently working, and that your main class is called <code>MainActivity</code>. These are the steps to follow:</p>
<h3>1. Create an Instagram account</h3>
<h3>2. <a href="https://instagram.com/developer/">Register you application</a></h3>
<h1>3. Register a New Client</h1>
<p>Fill the form fields as follows. Note that in the Redurect URI field, you need to configure a redirect URI with a custom scheme. For this example, I will use <em>customscheme</em>.</p>
<ul>
<li>Application Name: [your-app-name]</li>
<li>Description: [your-description]</li>
<li>Website URL: [your-website-url]</li>
<li><strong>Redirect URI(s): customscheme://oauth/callback/instagram/</strong></li>
<li>Contact email: [your-email]</li>
</ul>
<p>Then, click on the <strong>Security</strong> tab and uncheck the Disable implicit OAuth option. Save the Client.</p>
<h1>4. Add values to the strings.xml file</h1>
<p>After saving the Client, you will get the Client ID and Client Secret in the Instagram website. Add these values in your strings.xml file in your project:</p>
<pre><code>&lt;string name="instagram_id"&gt;yourClientId&lt;/string&gt;
&lt;string name="instagram_scheme"&gt;customscheme&lt;/string&gt;
&lt;string name="instagram_secret"&gt;yourClientSecret&lt;/string&gt;
&lt;string name="instagram_token"&gt;instagram_token&lt;/string&gt;
</code></pre>
<h1>5. Create the InstagramLogin Activity</h1>
<p>Start creating an Activity in your main package. The logic for the authentication process is the following:</p>
<ol>
<li>The system checks if there is an Access Token saved in SharedPreferences. </li>
<li>If there is, it redirects to MainActivity. </li>
<li>If not, it opens the Instagram authorization URL for the application.</li>
<li>The user authorizes the application in the browser.</li>
<li>The InstagramLogin Activity catches the Redirect URI with the <em>customscheme</em> from Instagram and gets the token.</li>
<li>The InstagramLogin Activity saves the token in SharedPreferences and redirects to MainActivity.</li>
</ol>
<p>These will be the methods that the Activity will need for the OAuth 2.0 Client-Side authentication:</p>
<pre><code>public class InstagramLogin extends Activity {
    private String TAG = "InstagramLogin";

    @Override
    public void onCreate(Bundle savedInstanceState) {
    }

    @Override
    protected void onNewIntent(Intent intent) {
    }

    private void handleAccessToken(Intent intent) {
    }

    private void redirectToMainActivity() {
    }
}
</code></pre>
<h2>5.1. onCreate method</h2>
<p>In this method, the Activity makes the first 3 steps in the process described above.</p>
<pre><code>    @Override
    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        Log.d(TAG, "onCreate");

        // Try to get Access Token from SharedPreferences
        SharedPreferences settings = PreferenceManager
                .getDefaultSharedPreferences(getApplicationContext());
        String auth_token_string = settings.getString(
                getApplicationContext().getString(R.string.instagram_token),
                "");

        // Check if Access Token exists
        if (auth_token_string.compareTo("") == 0) {
            // Construct the Instagram Authentication URL based on the strings.xml variables
            String instagramUrl = "https://instagram.com/oauth/authorize/?client_id=" +
                    getApplicationContext().getString(R.string.instagram_id) +
                    "&amp;redirect_uri=" +
                    getApplicationContext().getString(R.string.instagram_scheme) +
                    "%3A%2F%2Foauth%2Fcallback%2Finstagram%2F&amp;response_type=token";

            // Go to the URL
            Intent browserIntent = new Intent(Intent.ACTION_VIEW, Uri.parse(instagramUrl));
            startActivity(browserIntent);
        } else {
            redirectToMainActivity();
        }
    }
</code></pre>
<h2>5.2. onNewIntent method</h2>
<p>This method is called when the <code>Intent</code> is created in the <code>onCreate</code> method. The new Intent will be the one that will listen to the Redirect URI from the Instagram Authentication URL Response.</p>
<pre><code>    @Override
    protected void onNewIntent(Intent intent) {
        Log.d(TAG, "onNewIntent");
        super.onNewIntent(intent);
        handleAccessToken(intent);
    }
</code></pre>
<h2>5.3. handleAccessToken method</h2>
<p>This method gets the token from the Redirect URI and saves it in <code>SharedPreferences</code>.</p>
<pre><code>    private void handleAccessToken(Intent intent) {
        Log.d(TAG, "handleAccessToken");
        Uri uri = intent.getData();

        // check if the response uri starts with the custom scheme name
        if (uri != null &amp;&amp; uri.toString().startsWith(
                getApplicationContext().getString(R.string.instagram_scheme))) {
            String accessToken;
            if (uri.getFragment() != null) {
                // gets access token and saves it in SharedPreferences
                accessToken = uri.getFragment().replace("access_token=", "");
                SharedPreferences settings = PreferenceManager
                        .getDefaultSharedPreferences(getApplicationContext());
                SharedPreferences.Editor editor = settings.edit();
                editor.putString(getApplicationContext().getString(R.string.instagram_token),
                        accessToken);
                editor.apply();
                Log.d(TAG, "Found access token: " + accessToken);

                redirectToMainActivity();
            } else {
                Log.d(TAG, "Access token not found. URI: " + uri.toString());
                // Handle error here
            }
        }
    }
</code></pre>
<h2>5.4. redirectToMainActivity method</h2>
<p>This method starts the new MainActivity and finishes the InstagramLogin Activity.</p>
<pre><code>    private void redirectToMainActivity() {
        Intent intent = new Intent(this, MainActivity.class);
        startActivity(intent);
        finish();
    }
</code></pre>
<h1>6. Android Manifest</h1>
<p>In this file, you need to add an Intent Filter to the InstagramLogin Activity. According to the <a href="http://developer.android.com/guide/components/intents-filters.html">Docs</a>, an intent filter is an expression in an app's manifest file that specifies the type of intents that the component would like to receive. For instance, by declaring an intent filter for an activity, you make it possible for other apps to directly start your activity with a certain kind of intent.</p>
<p>With this intent filter, the InstagramLogin Activity can successfully listen to the Redirect URI from Instagram:</p>
<pre><code>    &lt;activity
        android:name=".main.InstagramLogin"
        android:launchMode="singleTop" &gt;
        &lt;intent-filter&gt;
            &lt;action android:name="android.intent.action.MAIN" /&gt;
            &lt;category android:name="android.intent.category.LAUNCHER" /&gt;
        &lt;/intent-filter&gt;
        &lt;intent-filter&gt;
            &lt;data android:scheme="customscheme" /&gt;
            &lt;action android:name="android.intent.action.VIEW" /&gt;
            &lt;category android:name="android.intent.category.DEFAULT" /&gt;
            &lt;category android:name="android.intent.category.BROWSABLE" /&gt;
        &lt;/intent-filter&gt;
    &lt;/activity&gt;
    &lt;activity
        android:name=".main.MainActivity"
        android:label="@string/title_activity_main" &gt;
    &lt;/activity&gt;
</code></pre>
    </div>
    
    
    
    
  </div>
  

  
  <footer class="entry-footer well">
    
    <p class="entry-tags">
      <span class="glyphicon glyphicon-tags"></span> <strong>Tags</strong> :
      
      <a href="/blog/tags/android/"
         title="Show all entries tagged by android"
         rel="tag">android</a>
      
      <a href="/blog/tags/instagram/"
         title="Show all entries tagged by instagram"
         rel="tag">instagram</a>
      
      <a href="/blog/tags/oauth2.0/"
         title="Show all entries tagged by oauth2.0"
         rel="tag">oauth2.0</a>
      
    </p>
    
    
    <p class="entry-shorturl">
      <span class="glyphicon glyphicon-bookmark"></span> <strong>Short url</strong> :
      <a href="http://example.com/blog/1/"
         title="Short URL to Android: How-to Authenticate with OAuth 2.0 - Client-Side in Instagram"
         rel="shortlink">
        http://example.com/blog/1/
      </a>
    </p>
    
    
    <p class="entry-discussions">
      <span class="glyphicon glyphicon-comment"></span> <strong>Discussions</strong> :
      
      
      
      
      No comments yet.
      <a href="/blog/2015/08/26/android-how-authenticate-oauth-20-client-side-instagram/#comment-form"
         title="Leave a comment on Android: How-to Authenticate with OAuth 2.0 - Client-Side in Instagram">
        Be first to comment!
      </a>
      
      
      
      
      
      
      
      
      
      
      
      
      
      
    </p>
    
  </footer>
  
</article>




<aside class="entry-widgets" role="complementary">
  
  
  
  
  
  
  <div class="entry-similar panel panel-default">
    <div class="panel-heading">
      Similar entries
    </div>
    
<ul class="list-group">
  
  <li class="list-group-item">
    No similar entries.
  </li>
  
</ul>

  </div>
  
  
  <div class="entry-prev-next">
    <ul class="pager">
      
      
      
      
      
      
    </ul>
  </div>
  
</aside>






<p>Pingbacks are open.</p>








<p>
  <a href="/blog/trackback/1/" rel="trackback">
    Trackback URL</a>
</p>







<p>No comments yet.</p>






  

<form action="/comments/post/" method="post" id="comment-form" class="well form-horizontal">
  <div><input type='hidden' name='csrfmiddlewaretoken' value='2haqrjSP7BX8v1mMTg496VGU1T5HGjCa' /></div>
  
  <fieldset>
    <legend>Post your comment</legend>
    <input type="hidden" name="next" value="/blog/comments/success/"/>
    
    <input id="id_content_type" name="content_type" type="hidden" value="zinnia.entry" />
    
    <input id="id_object_pk" name="object_pk" type="hidden" value="1" />
    
    <input id="id_timestamp" name="timestamp" type="hidden" value="1440638391" />
    
    <input id="id_security_hash" maxlength="40" name="security_hash" type="hidden" value="d7ab7a9f609fc31a3c98fe0913f62ea32e0a41a0" />
    
    
    
    <div>
      
      <div class="form-group">
        <label for="id_name" class="col-lg-2 control-label">Name</label>
        <div class="col-lg-10">
          
            <input type="text" id="id_name" class="form-control"  name="name" />
          
        </div>
      </div>
    </div>
    
    
    
    
    
    <div>
      
      <div class="form-group">
        <label for="id_email" class="col-lg-2 control-label">Email address</label>
        <div class="col-lg-10">
          
            <input type="text" id="id_email" class="form-control"  name="email" />
          
        </div>
      </div>
    </div>
    
    
    
    
    
    <div>
      
      <div class="form-group">
        <label for="id_url" class="col-lg-2 control-label">URL</label>
        <div class="col-lg-10">
          
            <input type="text" id="id_url" class="form-control"  name="url" />
          
        </div>
      </div>
    </div>
    
    
    
    
    
    <div>
      
      <div class="form-group">
        <label for="id_comment" class="col-lg-2 control-label">Comment</label>
        <div class="col-lg-10">
          
            <textarea id="id_comment" class="form-control" rows="10" name="comment"></textarea>
          
        </div>
      </div>
    </div>
    
    
    
    
    
    <div style="display:none;">
      
      <div class="form-group">
        <label for="id_honeypot" class="col-lg-2 control-label">If you enter anything in this field your comment will be treated as spam</label>
        <div class="col-lg-10">
          
            <input type="text" id="id_honeypot" class="form-control"  name="honeypot" />
          
        </div>
      </div>
    </div>
    
    
    
    
    <p class="submit">
      <input type="submit" name="submit" class="submit-post btn btn-primary submit-preview" value="Post" />
      <input type="submit" name="preview" class="submit-preview btn btn-default submit-post" value="Preview" />
    </p>
  </fieldset>
</form>





      </div>
      <div id="sidebar" role="complementary">
        

      </div>
      <footer id="footer" role="contentinfo">
        <p>Powered by <a href="http://www.djangoproject.com">Django</a> and <a href="https://github.com/Fantomas42/django-blog-zinnia">Zinnia 0.15.2</a>.</p>
      </footer>
    </div>
  </body>
</html>
